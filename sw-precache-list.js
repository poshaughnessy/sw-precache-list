'use strict';

const DEFAULT_OUTPUT_FILENAME = 'precache-list.js';

const fs = require('fs');
const argv = require('yargs').argv;
const colors = require('colors');
const glob = require('multi-glob').glob;

let outputFilename = DEFAULT_OUTPUT_FILENAME;

colors.setTheme({
  info: 'green',
  warn: 'yellow',
  error: 'red'
});

if (argv._.length < 1) {
  console.warn(colors.warn('Please provide one or more file globs'));
  return;
}

console.log('Glob patterns:', argv._);

glob(argv._, function(err, resources) {
  if (err) {
    console.error(colors.error('Glob error'), err);
    return;
  }
  console.log('Result:', resources);
  writeFile(outputFilename, resources);
});

function writeFile(filename, resourceList) {
  const output = `/* Generated by sw-precache-list */\nvar precacheList = ${JSON.stringify(resourceList)};`;
  fs.writeFile(filename, output, onFileWritten);

}

function onFileWritten() {
  console.log(colors.info(`Written ${outputFilename}`));
}
